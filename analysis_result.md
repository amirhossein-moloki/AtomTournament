# تحلیل مشکل گواهی SSL در Nginx

## نتیجه‌گیری نهایی

**علت اصلی مشکل:**

سرور Nginx شما به درستی با یک گواهی موقت (dummy) راه‌اندازی می‌شود تا از بروز خطا در ابتدای کار جلوگیری شود. مشکل اصلی این است که پس از دریافت گواهی واقعی توسط Certbot، **مکانیزم بارگذاری مجدد (reload) در Nginx هرگز فعال نمی‌شود.**

**چرا فعال نمی‌شود؟**

دلیل این اتفاق، نقص در نحوه نظارت بر تغییرات فایل‌هاست. اسکریپت شما با ابزار `inotifywait` پوشه‌ای را تحت نظر دارد که حاوی **لینک‌های نمادین (symbolic links)** به گواهی‌هاست. وقتی Certbot گواهی جدیدی می‌گیرد، فقط مقصد این لینک‌ها را تغییر می‌دهد، نه خود پوشه را. `inotifywait` به این نوع تغییر (تغییر مقصد لینک) حساس نیست و در نتیجه هیچ رویدادی را تشخیص نمی‌دهد.

به زبان ساده: **Nginx هرگز خبردار نمی‌شود که گواهی جدیدی آماده شده است** و به همین دلیل با همان گواهی موقت اولیه به کار خود ادامه می‌دهد.
