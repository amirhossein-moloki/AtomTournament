# گزارش مشکلات پروژه TournamentPlatformDjango

این گزارش به بررسی مشکلات موجود در پروژه TournamentPlatformDjango می‌پردازد و راه‌حل‌های پیشنهادی برای هر مشکل ارائه می‌دهد.

## مشکلات ساختاری

### 1. یک برنامه برای همه چیز

**مشکل:** کل منطق برنامه در یک برنامه به نام `api` قرار دارد. این کار باعث می‌شود که با بزرگ شدن پروژه، نگهداری و توسعه آن دشوار شود.

**راه‌حل:** برنامه را به بخش‌های کوچکتر و مستقل تقسیم کنید. به عنوان مثال:

*   `users`: برای مدیریت کاربران، پروفایل‌ها و احراز هویت.
*   `tournaments`: برای مدیریت بازی‌ها، تورنومنت‌ها، تیم‌ها و مسابقات.
*   `wallet`: برای مدیریت کیف پول و تراکنش‌ها.

### 2. عدم استفاده از سرویس‌ها

**مشکل:** منطق تجاری مستقیماً در ویوها (یا در این مورد، عدم وجود آن) قرار دارد. این کار باعث می‌شود که کد تکراری زیادی نوشته شود و تست کردن آن دشوار باشد.

**راه‌حل:** از یک لایه سرویس برای جداسازی منطق تجاری از ویوها استفاده کنید. هر سرویس مسئول یک بخش خاص از منطق تجاری خواهد بود (مثلاً `TournamentService` برای ایجاد و مدیریت تورنومنت‌ها).

## مشکلات مدل‌ها

### 1. `User.phone_number`

**مشکل:** این فیلد `unique=True` است، اما هیچ اعتبارسنجی برای فرمت شماره تلفن وجود ندارد.

**راه‌حل:** از یک کتابخانه مانند `django-phonenumber-field` برای اعتبارسنجی و ذخیره شماره تلفن‌ها استفاده کنید.

### 2. `Profile.in_game_ids`

**مشکل:** استفاده از `JSONField` برای این فیلد ممکن است در آینده مشکل‌ساز شود، به خصوص اگر نیاز به جستجو یا فیلتر بر اساس این شناسه‌ها باشد.

**راه‌حل:** یک مدل جداگانه به نام `InGameID` با فیلدهای `profile`, `game`, `game_id` ایجاد کنید.

### 3. `Tournament.participants` و `Tournament.teams`

**مشکل:** یک تورنومنت می‌تواند هم شرکت‌کننده و هم تیم داشته باشد که ممکن است منطق را پیچیده کند.

**راه‌حل:** یک فیلد `type` به مدل `Tournament` اضافه کنید که نوع تورنومنت (فردی یا تیمی) را مشخص کند. سپس بر اساس نوع تورنومنت، از یکی از فیلدهای `participants` یا `teams` استفاده کنید.

### 4. `Match.winner`

**مشکل:** این فیلد به `Team` اشاره دارد، اما تورنومنت‌ها می‌توانند فردی هم باشند.

**راه‌حل:** از یک `GenericForeignKey` برای فیلد `winner` استفاده کنید تا بتواند به `Team` یا `User` اشاره کند.

### 5. `Wallet` و `Transaction`

**مشکل:** منطق مربوط به کیف پول و تراکنش‌ها بسیار ساده است و هیچ‌گونه مدیریتی برای موارد خاص مانند مسدود کردن پول برای شرکت در تورنومنت یا بازپرداخت در صورت لغو تورنومنت وجود ندارد.

**راه‌حل:** منطق مربوط به کیف پول را در یک سرویس جداگانه پیاده‌سازی کنید و متدهایی برای مسدود کردن، آزاد کردن و انتقال پول اضافه کنید.

## مشکلات ویوها و سریالایزرها

### 1. استفاده از `ModelViewSet` برای همه چیز

**مشکل:** این کار انعطاف‌پذیری را کاهش می‌دهد و امکان پیاده‌سازی منطق سفارشی را دشوار می‌کند.

**راه‌حل:** از `ViewSet`های سفارشی یا `APIView` برای اندپوینت‌هایی که نیاز به منطق پیچیده دارند استفاده کنید. به عنوان مثال، برای ثبت‌نام کاربر، یک اندپوینت سفارشی `/api/users/register/` ایجاد کنید.

### 2. عدم وجود مجوزها (Permissions)

**مشکل:** هیچ‌گونه مجوزی برای اندپوینت‌ها تعریف نشده است.

**راه‌حل:** از سیستم مجوزهای Django Rest Framework برای کنترل دسترسی به اندپوینت‌ها استفاده کنید. به عنوان مثال، فقط کاربران `admin` یا `tournament_manager` باید بتوانند تورنومنت ایجاد کنند.

### 3. عدم وجود فیلتر و جستجو

**مشکل:** هیچ‌گونه فیلتر یا جستجویی برای لیست‌ها پیاده‌سازی نشده است.

**راه‌حل:** از کتابخانه `django-filter` برای اضافه کردن قابلیت فیلتر به اندپوینت‌ها استفاده کنید.

### 4. نمایش تمام فیلدها در سریالایزرها

**مشکل:** سریالایزرها تمام فیلدهای مدل را نمایش می‌دهند که ممکن است از نظر امنیتی یا کارایی مشکل‌ساز باشد.

**راه‌حل:** فیلدهایی که باید در هر سریالایزر نمایش داده شوند را به صراحت مشخص کنید.

## مشکلات امنیتی

### 1. `SECRET_KEY` در کد

**مشکل:** کلید مخفی پروژه به صورت هاردکد در `settings.py` قرار دارد.

**راه‌حل:** کلید مخفی را از طریق متغیرهای محیطی بخوانید.

### 2. `DEBUG = True`

**مشکل:** این گزینه در محیط پروداکشن باید `False` باشد.

**راه‌حل:** مقدار `DEBUG` را بر اساس یک متغیر محیطی تنظیم کنید.

### 3. عدم وجود اعتبارسنجی ورودی

**مشکل:** هیچ‌گونه اعتبارسنجی برای ورودی‌های کاربر وجود ندارد.

**راه‌حل:** از `serializers` برای اعتبارسنجی تمام ورودی‌های کاربر استفاده کنید.

## مشکلات دیگر

### 1. عدم وجود مستندات

**مشکل:** هیچ‌گونه مستنداتی برای API وجود ندارد.

**راه‌حل:** از یک کتابخانه مانند `drf-yasg` یا `drf-spectacular` برای تولید خودکار مستندات API استفاده کنید.

### 2. عدم وجود تست

**مشکل:** هیچ تستی برای پروژه نوشته نشده است.

**راه‌حل:** برای تمام بخش‌های پروژه، تست‌های واحد (unit tests) و تست‌های یکپارچه‌سازی (integration tests) بنویسید.
