# جریان منطقی کاربر

این سند مسیر معمول یک کاربر عادی در پلتفرم مسابقات را، از ثبت‌نام اولیه تا رقابت و برنده شدن، تشریح می‌کند.

## ۱. ورود و ثبت‌نام

1.  **ثبت‌نام:** یک کاربر جدید با ارائه نام کاربری منحصر به فرد، رمز عبور و شماره تلفن معتبر در پلتفرم ثبت‌نام می‌کند.
2.  **تأیید:** سیستم یک رمز عبور یک‌بار مصرف (OTP) به شماره تلفن کاربر ارسال می‌کند تا آن را تأیید کند. کاربر باید این رمز را برای فعال‌سازی حساب خود وارد کند.
3.  **ایجاد حساب:** پس از تأیید موفق، یک حساب `User` ایجاد می‌شود.
4.  **تنظیمات پیش‌فرض:**
    *   به کاربر به طور خودکار یک نقش پیش‌فرض (مانند "Player") اختصاص داده می‌شود.
    *   یک `Wallet` (کیف پول) برای کاربر با موجودی اولیه صفر ایجاد می‌شود.
5.  **تکمیل پروفایل:** کاربر می‌تواند به صفحه پروفایل خود برود تا جزئیات بیشتری مانند عکس پروفایل را اضافه کند.

## ۲. تیم‌ها و شناسه‌های بازی

-   **شناسه‌های داخل بازی (In-Game IDs):** برای بسیاری از بازی‌ها، کاربران باید نام کاربری یا شناسه خود در بازی را اضافه کنند. آن‌ها می‌توانند چندین `InGameID` اضافه کنند و حساب پلتفرم خود را به هویت خود در بازی‌های مختلف پیوند دهند.
-   **مدیریت تیم (برای مسابقات تیمی):**
    1.  **ایجاد تیم:** یک کاربر می‌تواند یک `Team` جدید ایجاد کند که به طور خودکار او را کاپیتان تیم می‌کند.
    2.  **ارسال دعوت‌نامه:** کاپیتان می‌تواند برای سایر کاربران دعوت‌نامه ارسال کند تا به تیم او بپیوندند.
    3.  **پیوستن به تیم:** کاربران دعوت‌شده یک نوتیفیکیشن دریافت می‌کنند و می‌توانند دعوت را بپذیرند یا رد کنند. در صورت پذیرش، آن‌ها عضو تیم می‌شوند. یک کاربر می‌تواند عضو چندین تیم باشد.

## ۳. پیدا کردن و پیوستن به مسابقه

1.  **مرور:** کاربر می‌تواند لیستی از تمام مسابقات موجود را مرور کند. این لیست می‌تواند بر اساس بازی، نوع مسابقه (انفرادی در مقابل تیمی)، هزینه ورود (رایگان یا پولی) و معیارهای دیگر فیلتر شود.
2.  **مشاهده جزئیات:** با انتخاب یک مسابقه، کاربر می‌تواند تمام جزئیات آن را ببیند: قوانین، مجموع جوایز، تاریخ شروع و پایان، تعداد شرکت‌کنندگان، اندازه تیم و هرگونه محدودیت رنک.
3.  **ثبت‌نام:**
    *   کاربر روی دکمه "ثبت‌نام" کلیک می‌کند.
    *   **اعتبارسنجی:** سیستم بررسی می‌کند که آیا کاربر تمام شرایط را دارد:
        *   آیا سطح تأیید حساب او کافی است؟
        *   آیا `Rank` (رتبه) او در محدوده مجاز تورنومنت قرار دارد؟
        *   اگر مسابقه تیمی است، آیا تیم کاربر معتبر است و تعداد بازیکنان صحیح را دارد؟
    *   **هزینه ورود:** اگر مسابقه رایگان نباشد، هزینه ورود از `Wallet` کاربر کسر می‌شود. یک `Transaction` برای این پرداخت ثبت می‌شود.
    *   **تأیید نهایی:** یک رکورد `Participant` ایجاد می‌شود که به طور رسمی کاربر (یا تیم او) را در مسابقه ثبت می‌کند.

## ۴. رقابت

1.  **اعلام حضور (Check-in):** کمی قبل از شروع مسابقه، یک پنجره زمانی برای اعلام حضور باز می‌شود. کاربر باید در صفحه مسابقه حضور خود را تأیید کند تا مشارکت خود را قطعی کند. فقط بازیکنانی که اعلام حضور کرده‌اند در براکت قرار می‌گیرند.
2.  **ایجاد براکت:** پس از بسته شدن پنجره اعلام حضور، سیستم به طور خودکار براکت مسابقه و `Match`های دور اول را ایجاد می‌کند.
3.  **جزئیات مسابقه:** کاربر می‌تواند مسابقه فعلی خود را در داشبورد خود ببیند که شامل نام حریف و `room_id` و `password` برای لابی داخل بازی است.
4.  **انجام بازی:** شرکت‌کنندگان به لابی مشخص شده در بازی می‌پیوندند و طبق قوانین مسابقه بازی می‌کنند.

## ۵. نتایج و اختلافات

1.  **گزارش امتیاز:** پس از پایان بازی، برنده مسئول گزارش نتیجه در پلتفرم است، که اغلب با بارگذاری یک اسکرین‌شات (`result_proof`) به عنوان مدرک انجام می‌شود.
2.  **تأیید نتیجه:** حریف نتیجه را تأیید می‌کند. پس از تأیید، سیستم وضعیت مسابقه را به‌روز کرده و برنده را به دور بعد می‌برد.
3.  **اختلافات (Disputes):** اگر بازیکنی با نتیجه گزارش‌شده مخالف باشد، می‌تواند یک اختلاف ثبت کند. این کار نتیجه مسابقه را مسدود کرده و آن را برای بررسی توسط مدیر تورنومنت یا کارکنان پشتیبانی علامت‌گذاری می‌کند.
4.  **گزارش تخلف:** اگر کاربری شاهد تقلب یا رفتار ناشایست دیگری باشد، می‌تواند یک `Report` علیه بازیکن دیگر ثبت کند و توضیحات و مدارک ارائه دهد. این نیز یک فرآیند بررسی را آغاز می‌کند.

## ۶. برنده شدن و جوایز

1.  **صعود:** کاربر تا زمانی که به بردن ادامه دهد، به بازی در مسابقات ادامه می‌دهد. اگر ببازد، حذف می‌شود.
2.  **پایان مسابقه:** مسابقه زمانی به پایان می‌رسد که یک برنده نهایی مشخص شود.
3.  **دریافت جوایز:**
    *   جایزه نقدی به طور خودکار به `Wallet` برندگان منتقل می‌شود. این به عنوان یک تراکنش `prize` ظاهر شده و `withdrawable_balance` (موجودی قابل برداشت) آن‌ها را افزایش می‌دهد.
    *   رکورد `Participant` کاربر به‌روز می‌شود تا رتبه نهایی و مبلغ جایزه‌ای که برده است را نشان دهد.
4.  **به‌روزرسانی امتیاز و رتبه:**
    *   بازیکنان برتر امتیازاتی دریافت می‌کنند که `score` کلی آن‌ها را افزایش می‌دهد.
    *   اگر امتیاز کاربری از یک آستانه مشخص عبور کند، `Rank` او به طور خودکار به‌روز می‌شود (مثلاً از "طلایی" به "پلاتینیوم").
5.  **ارسال ویدئوی برنده:** برای برخی از مسابقات ویژه، ممکن است از برندگان خواسته شود قبل از دریافت جایزه، ویدئویی از گیم‌پلی خود را برای نمایش در پلتفرم ارسال کنند.
