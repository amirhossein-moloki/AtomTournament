
# توضیحات مربوط به لاگین با گوگل

در این پروژه، قابلیت لاگین با گوگل به صورت یک فلو (flow) سمت بک‌اند پیاده‌سازی شده است. در ادامه، مراحل کارکرد این سیستم به صورت گام به گام توضیح داده می‌شود:

### ۱. شروع فرآیند از سمت فرانت‌اند
کاربر در اپلیکیشن فرانت‌اند روی دکمه "ورود با گوگل" کلیک می‌کند. فرانت‌اند مسئولیت مدیریت فرآیند `OAuth 2.0` گوگل را بر عهده دارد و پس از احراز هویت موفق، یک `id_token` از گوگل دریافت می‌کند.

### ۲. ارسال توکن به بک‌اند
فرانت‌اند این `id_token` را در یک درخواست `POST` به اندپوینت `/api/auth/google/login/` در بک‌اند ارسال می‌کند.

### ۳. اعتبارسنجی توکن در بک‌اند
بک‌اند `id_token` را دریافت کرده و اقدامات زیر را انجام می‌دهد:
- با استفاده از کتابخانه `google-auth`، صحت و اعتبار توکن را بررسی می‌کند.
- توکن را با `GOOGLE_CLIENT_ID` که در متغیرهای محیطی (`.env`) تنظیم شده، مقایسه می‌کند تا اطمینان حاصل شود که توکن برای همین اپلیکیشن صادر شده است.
- اگر توکن نامعتبر یا منقضی شده باشد، یک خطا برمی‌گرداند.

### ۴. استخراج اطلاعات کاربر
در صورت معتبر بودن توکن، بک‌اند آدرس ایمیل کاربر را از اطلاعات داخل توکن استخراج می‌کند.

### ۵. جستجوی کاربر در دیتابیس
سیستم در دیتابیس به دنبال کاربری می‌گردد که آدرس ایمیل آن با ایمیل استخراج شده از توکن مطابقت داشته باشد.

### ۶. نتیجه احراز هویت
- **اگر کاربر وجود داشته باشد:** در صورتی که کاربری با آن ایمیل پیدا شود، بک‌اند او را به عنوان کاربر احراز هویت شده در نظر می‌گیرد. سپس توکن‌های دسترسی (access) و تازه‌سازی (refresh) مخصوص خود برنامه را (با استفاده از `djangorestframework-simplejwt`) برای آن کاربر تولید کرده و به فرانت‌اند بازمی‌گرداند. فرانت‌اند از این توکن‌ها برای ارسال درخواست‌های بعدی به API استفاده می‌کند.
- **اگر کاربر وجود نداشته باشد:** در صورتی که هیچ کاربری با آن ایمیل پیدا نشود، بک‌اند خطای `404 Not Found` برمی‌گرداند. **نکته مهم این است که پیاده‌سازی فعلی به صورت خودکار حساب کاربری جدید ایجاد نمی‌کند** و فقط به کاربران موجود اجازه ورود می‌دهد.

### تنظیمات مورد نیاز
برای اینکه این قابلیت به درستی کار کند، متغیرهای محیطی زیر باید در فایل `.env` تنظیم شوند:
- `GOOGLE_CLIENT_ID`: شناسه‌ی کلاینت که از پروژه در Google Cloud Console دریافت می‌شود.
- `GOOGLE_REDIRECT_URI`: آدرس بازگشتی (callback URL) که در پروژه Google Cloud Console ثبت شده است.

تمام این منطق در کلاس `GoogleLoginView` داخل فایل `users/views.py` پیاده‌سازی شده است.
