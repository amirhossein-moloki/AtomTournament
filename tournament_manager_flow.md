# جریان منطقی مدیر تورنومنت

این سند گردش کار یک مدیر تورنومنت را توصیف می‌کند؛ کاربری که مسئول ایجاد، مدیریت و نظارت بر تورنومنت‌های یک بازی خاص است.

## ۱. نقش و دسترسی‌ها

-   یک مدیر تورنومنت معمولاً یک کاربر مورد اعتماد است که دسترسی‌های ویژه‌ای از طرف یک ادمین به او اعطا شده است.
-   نقش او اغلب از طریق مدل `GameManager` به یک `Game` خاص مرتبط است، به این معنی که او فقط می‌تواند تورنومنت‌های بازی‌هایی را که به او اختصاص داده شده، مدیریت کند.
-   او به یک داشبورد اختصاصی برای مدیریت تورنومنت‌ها دسترسی دارد.

## ۲. ایجاد تورنومنت

1.  **شروع:** مدیر به داشبورد خود می‌رود و گزینه ایجاد یک تورنومنت جدید را انتخاب می‌کند.
2.  **پیکربندی:** او یک فرم دقیق را برای تعریف پارامترهای تورنومنت پر می‌کند:
    *   **اطلاعات پایه:** `name` (نام)، `game` (بازی)، `rules` (قوانین).
    *   **فرمت:** `type` (انفرادی یا تیمی)، `mode` (مثلاً Battle Royale)، `max_participants` (حداکثر شرکت‌کنندگان).
    *   **مشخصات تیم:** `team_size` (اندازه تیم) برای رویدادهای تیمی.
    *   **زمان‌بندی:** `start_date` (تاریخ شروع)، `end_date` (تاریخ پایان) و `countdown_start_time` (زمان شمارش معکوس) برای لابی.
    *   **شرایط ورود:**
        *   `is_free` (رایگان) یا پولی (`entry_fee`).
        *   `required_verification_level` (سطح تأیید هویت مورد نیاز) برای بازیکنان.
        *   حداقل و حداکثر `Rank` (رتبه) مجاز برای پیوستن.
3.  **انتشار:** پس از ارسال فرم، `Tournament` ایجاد شده و در مرورگر عمومی برای مشاهده و پیوستن کاربران لیست می‌شود. فیلد `creator` (ایجادکننده) بر روی حساب کاربری مدیر تنظیم می‌شود.

## ۳. مدیریت چرخه حیات تورنومنت

1.  **نظارت بر ثبت‌نام:** مدیر می‌تواند لیست `Participant`ها و `Team`های ثبت‌نام‌شده را به صورت بی‌درنگ از داشبورد خود نظارت کند.
2.  **ویرایش‌های پیش از تورنومنت:** او می‌تواند بیشتر جزئیات تورنومنت را *قبل* از شروع رویداد ویرایش کند.
3.  **شروع تورنومنت:**
    *   در حالی که بسیاری از تورنومنت‌ها ممکن است به طور خودکار در `start_date` برنامه‌ریزی‌شده شروع شوند، یک مدیر ممکن است گزینه شروع دستی را داشته باشد.
    *   شروع تورنومنت معمولاً شرکت‌کنندگان را قفل کرده و فرآیند ایجاد براکت را آغاز می‌کند.
4.  **نظارت زنده:** در طول تورنومنت، مدیر می‌تواند براکت زنده را مشاهده کند، نتایج مسابقات را به محض ورود ببیند و هرگونه مشکلی را نظارت کند.

## ۴. قضاوت و حل مسائل

مدیر تورنومنت مرجع اصلی برای حل مسائل در تورنومنت خود است.

1.  **رسیدگی به اختلافات (Disputes):**
    *   هنگامی که یک `Match` مورد اختلاف قرار می‌گیرد، به مدیر اطلاع داده می‌شود.
    *   او `dispute_reason` (دلیل اختلاف)، `result_proof` (مدرک نتیجه) ارائه‌شده توسط هر دو طرف و هرگونه لاگ چت را بررسی می‌کند.
    *   بر اساس شواهد، او یک حکم صادر می‌کند: `winner` (برنده) مسابقه را به صورت دستی تنظیم کرده و پرچم `is_disputed` را پاک می‌کند.
2.  **بررسی گزارش‌ها (Reports):**
    *   هنگامی که کاربری یک `Report` برای تقلب یا رفتار ناشایست ثبت می‌کند، مدیر `description` (توضیحات) و `evidence` (مدارک) را بررسی می‌کند.
    *   اگر گزارش معتبر باشد، مدیر می‌تواند اقدام کند، مانند رد صلاحیت بازیکن متخلف.
    *   اگر مسئله شدید باشد، او می‌تواند آن را به یک ادمین سیستم ارجاع دهد.

## ۵. نهایی‌سازی تورنومنت

1.  **تأیید برندگان:** پس از اتمام مسابقه نهایی، مدیر نتایج را تأیید می‌کند.
2.  **اختصاص رتبه‌های برتر:** او با افزودن کاربران یا تیم‌ها به فیلدهای `top_players` و `top_teams` در آبجکت `Tournament`، رتبه‌بندی نهایی را به طور رسمی ثبت می‌کند.
3.  **آغاز پرداخت‌ها و امتیازدهی:** این اقدام معمولاً یک فرآیند خودکار را آغاز می‌کند:
    *   تابع `distribute_scores` فراخوانی شده و به بازیکنان برتر امتیاز می‌دهد.
    *   منطق توزیع جوایز اجرا شده و پرداخت‌ها به کیف پول برندگان ارسال می‌شود.
4.  **بررسی ویدئوهای ارسالی:** اگر تورنومنت نیاز به `WinnerSubmission` (مانند یک ویدئو) داشته باشد، مدیر فایل ارسالی را بررسی کرده و آن را تأیید یا رد می‌کند. پرداخت جایزه ممکن است منوط به این تأیید باشد.
5.  **آرشیو کردن:** پس از نهایی‌سازی، تورنومنت به وضعیت "تکمیل‌شده" یا "آرشیو شده" منتقل می‌شود.
