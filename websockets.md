# مستندات وب‌ساکت

این مستندات به شما کمک می‌کند تا از وب‌ساکت‌های موجود در این پروژه برای ویژگی‌های real-time مانند چت و نوتیفیکیشن‌ها استفاده کنید.

## اتصال به وب‌ساکت

برای اتصال به وب‌ساکت، باید از یک کتابخانه کلاینت وب‌ساکت (مانند `socket.io-client` برای جاوااسکریپت) استفاده کنید. آدرس وب‌ساکت به‌صورت `ws://<your-domain>/ws/<endpoint>/` است.

### اندپوینت‌ها

- `/ws/chat/<conversation_id>/`: برای چت real-time در یک مکالمه.
- `/ws/notifications/`: برای نوتیفیکیشن‌های real-time کاربر احراز هویت شده.

### احراز هویت

در این پروژه، احراز هویت از طریق `TokenMiddleware` انجام می‌شود. برای این کار، توکن احراز هویت کاربر باید در هدر `Authorization` به‌صورت `Bearer <your-auth-token>` ارسال شود.

**مثال:**

```javascript
const socket = new WebSocket('ws://<your-domain>/ws/notifications/', {
  headers: {
    Authorization: 'Bearer <your-auth-token>'
  }
});
```

## وب‌ساکت چت

### ارسال پیام

برای ارسال پیام در یک مکالمه، یک آبجکت JSON با ساختار زیر به وب‌ساکت چت ارسال کنید:

```json
{
  "type": "chat_message",
  "message": "محتوای پیام شما"
}
```

### ویرایش پیام

برای ویرایش یک پیام، آبجکت زیر را ارسال کنید:

```json
{
  "type": "edit_message",
  "message_id": 123,
  "content": "محتوای جدید پیام"
}
```

### حذف پیام

برای حذف یک پیام، آبجکت زیر را ارسال کنید:

```json
{
  "type": "delete_message",
  "message_id": 123
}
```

### دریافت پیام‌ها

هنگامی که پیام جدیدی در مکالمه ارسال شود، یک آبجکت JSON با ساختار زیر از وب‌ساکت چت دریافت خواهید کرد:

```json
{
  "id": 123,
  "sender": "username",
  "content": "محتوای پیام",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### دریافت پیام ویرایش شده

```json
{
  "type": "message.edited",
  "message": {
    "id": 123,
    "content": "محتوای جدید پیام"
  }
}
```

### دریافت پیام حذف شده

```json
{
  "type": "message.deleted",
  "message_id": 123
}
```

## وب‌ساکت نوتیفیکیشن‌ها

### دریافت نوتیفیکیشن

هنگامی که نوتیفیکیشن جدیدی برای کاربر احراز هویت شده در دسترس باشد، یک آبجکت JSON با ساختار زیر از وب‌ساکت نوتیفیکیشن‌ها دریافت خواهید کرد:

```json
{
  "message": {
    "id": 1,
    "message": "پیام نوتیفیکیشن",
    "is_read": false,
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### علامت‌گذاری نوتیفیکیشن‌ها به‌عنوان خوانده شده

برای علامت‌گذاری یک نوتیفیکیشن به‌عنوان خوانده شده، باید یک درخواست به REST API ارسال کنید، نه از طریق وب‌ساکت.
